 ---
 layout: page
 ---

 h1. Bugs found while writing specs
 
 h2. Our policy of dealing with bugs found in MRI
 
 * Ruby-Core must be notified
 * Use #ruby_bug guard for the spec code that breaks due to MRI bug
 * Add the bug to this page below
 * MRI specific bug should be filed (optional, but highly desirable)
 
 h2. Bugs in the Complex library
 
 h3. Incompatible changes to the Math module
 
 Complex modifies the Math library in a way that breaks compatibility in many ways.
 
 <pre><code class="ruby">
   Math.log("10") # => 2.30258509299405
   require "complex"
   Math.log("10") # => raises NoMethodError: undefined method `polar' for "10":String
 </code></pre>
 
 Running the Math specs after the Complex specs, exposes a total of *50 errors/failures*.
 
 <pre>
 bin/mspec -t r spec/ruby/1.8/library/complex/ spec/ruby/1.8/core/math/
 
 ...
 
 77 files, 433 examples, 977 expectations, 33 failures, 17 errors
 </pre>
 
 See the attached complex_math.patch file for fixes.
 
 h3. Some of Complex' methods fail when the Complex contains Floats
 
 <pre><code class="ruby">
   require "complex"
   Complex(3, 4).numerator # => Complex(3, 4)
   Complex(3.6, 3).numerator # => raises NoMethodError: undefined method `denominator' for 3.6:Float
 </code></pre>
 
 I think it would be more appropriate to raise a "real" exception.
 
 h3. Complex#hash might cause problems
 
 <pre><code class="ruby">
   require "complex"
   Complex(3, 4).hash # => 14
   Complex(4, 3).hash # => 14
 </code></pre>
 
 h2. Bugs in the Rational library
 
 h3. Rational#hash might cause problems
 
 <pre><code class="ruby">
   require "rational"
   Rational(3, 4).hash # => 14
   Rational(4, 3).hash # => 14
 </code></pre>
 
 h2. Bugs in the Net::FTP library
 
 h3. A response code of type 5xx (unless it is 500) when calling Net::FTP#chdir results in a NoMethodError.
 
 The offending line is in net/ftp.rb at line 671:
 
 <pre><code class="ruby">
 if $![0, 3] != "500"
 </code></pre>
 
 Exceptions do not respond to the method #[], thus this line results in a NoMethodError.
 
 A fix for this problem is to change the line to:
 
 <pre><code class="ruby">
 if $!.message[0, 3] != "500"
 </code></pre>

